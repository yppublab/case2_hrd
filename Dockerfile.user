FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    openssh-server sudo vim less net-tools iproute2 wireguard-tools nano samba-client libpam-pwquality && \
    useradd -m -s /bin/bash e.ivanov && echo "e.ivanov:ivanovpass" | chpasswd

COPY ./secrets/admin_id_rsa /root/admin_id_rsa
RUN if [ -f /root/id_rsa ]; then chmod 600 /root/admin_id_rsa; fi

RUN mkdir -p /home/e.ivanov 

RUN echo "e.ivanov ALL=(root) NOPASSWD: /usr/bin/nano" > /etc/sudoers.d/e_ivanov_nano && \
    chmod 0440 /etc/sudoers.d/e_ivanov_nano

# Копируем ключи SSH учеток
COPY ./secrets/ /tmp/secrets/

EXPOSE 22
COPY ./container-start.sh /usr/local/bin/start.sh
RUN chmod +x /usr/local/bin/start.sh
CMD ["/usr/local/bin/start.sh", "fileserver"]
CMD ["/usr/local/bin/start.sh", "user"]

