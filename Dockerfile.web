# Стейдж c busybox (даёт статический /bin/busybox, в нём есть nc)
FROM alpine:3.19 AS bb
RUN apk add --no-cache busybox-static

# Обновленный веб: Langflow 1.6.x (уязвим до 1.3.0 — CVE-2025-3248)
FROM langflowai/langflow:1.6.3

# Добавим nc (через busybox) и подготовим каталог с артефактами
USER root
COPY --from=bb /bin/busybox /usr/local/bin/busybox
RUN ln -sf /usr/local/bin/busybox /usr/local/bin/nc && \
    mkdir -p /opt/webdata

COPY ./container-start.sh /usr/local/bin/start.sh
RUN chmod +x /usr/local/bin/start.sh
CMD ["/usr/local/bin/start.sh"]


